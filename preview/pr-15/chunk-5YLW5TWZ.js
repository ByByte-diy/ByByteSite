import{a as W,c as Z}from"./chunk-C62FBGDK.js";import{a as J,b as ee}from"./chunk-DRQAWZPS.js";import{a as q}from"./chunk-R532DMSC.js";import{a as K,b as G}from"./chunk-DEHXC33R.js";import{$ as a,Da as F,E as z,Fa as M,I as R,Ia as L,K as H,Ka as U,M as s,Q as y,Ta as N,U as h,V as f,Wa as ie,X as B,Y as A,Z as Y,Za as Q,_ as C,aa as l,ba as P,db as oe,fb as $,gb as T,ha as S,hb as O,ja as w,la as c,oa as V,pa as I,qa as D,ra as X,sa as j,t as u,ta as d,ua as _,va as k,x as m,y as p,ya as x,za as b}from"./chunk-D62UBXSY.js";import"./chunk-ASRB7XND.js";M();U();oe();M();ie();U();M();var le=["markdownContainer"],ce=["previewImage"];function de(r,t){if(r&1&&(a(0,"span",19),d(1),l()),r&2){let e=t.$implicit;s(),_(e)}}function me(r,t){if(r&1&&(a(0,"div",14),A(1,de,2,1,"span",19,B),l()),r&2){let e=c(2);s(),Y(e.lesson.tags)}}function pe(r,t){if(r&1&&(a(0,"div",15)(1,"span",20),d(2),l()()),r&2){let e=c(2);s(2),k("v",e.lesson.version)}}function ge(r,t){if(r&1){let e=S();a(0,"div",21),w("click",function(){m(e);let i=c(2);return p(i.closePreview())}),a(1,"div",22),w("click",function(i){return m(e),p(i.stopPropagation())})("pointerdown",function(i){m(e);let o=c(2);return p(o.onPreviewPointerDown(i))})("pointermove",function(i){m(e);let o=c(2);return p(o.onPreviewPointerMove(i))})("pointerup",function(i){m(e);let o=c(2);return p(o.onPreviewPointerUp(i))})("pointercancel",function(i){m(e);let o=c(2);return p(o.onPreviewPointerUp(i))})("pointerleave",function(i){m(e);let o=c(2);return p(o.onPreviewPointerUp(i))})("wheel",function(i){m(e);let o=c(2);return p(o.onPreviewWheel(i))}),P(2,"img",23,1),a(4,"div",24)(5,"button",25),w("click",function(){m(e);let i=c(2);return p(i.changeZoom(.2))}),d(6,"+"),l(),a(7,"button",26),w("click",function(){m(e);let i=c(2);return p(i.changeZoom(-.2))}),d(8,"-"),l(),a(9,"button",27),w("click",function(){m(e);let i=c(2);return p(i.resetPreviewTransform())}),d(10," Reset "),l()(),a(11,"button",28),w("click",function(){m(e);let i=c(2);return p(i.closePreview())}),d(12," Close "),l()()()}if(r&2){let e=c(2);s(),j("dragging",e.isPreviewDragging),s(),X("transform",e.previewTransformStyle),C("src",e.previewImageSrc,R)("alt",e.previewImageAlt)}}function ve(r,t){if(r&1&&(a(0,"div",2)(1,"div",4)(2,"div",5)(3,"div",6)(4,"span",7),d(5),l(),a(6,"span",8),d(7),x(8,"translate"),l()(),a(9,"div",9)(10,"span",10),d(11),l(),a(12,"span",11),d(13),x(14,"translate"),l()()(),a(15,"h1",12),d(16),l(),a(17,"div",13),h(18,me,3,0,"div",14),h(19,pe,3,1,"div",15),l()(),a(20,"div",16,0),P(22,"markdown",17),l(),h(23,ge,13,6,"div",18),l()),r&2){let e=c();s(5),_(e.iconsService.getPlatformIcon(e.lesson.platforms[0])),s(2),_(b(8,9,"lessons.platform."+e.lesson.platforms[0])),s(4),_(e.iconsService.getLevelIcon(e.lesson.level)),s(2),_(b(14,11,"lessons.level."+e.lesson.level)),s(3),_(e.lesson.title),s(2),f(e.lesson.tags&&e.lesson.tags.length?18:-1),s(),f(e.lesson.version?19:-1),s(3),C("data",e.markdownContent),s(),f(e.isPreviewOpen?23:-1)}}function we(r,t){r&1&&(a(0,"div",3)(1,"p"),d(2),x(3,"translate"),l()()),r&2&&(s(2),_(b(3,1,"lessons.loading")))}var E=class r{lesson=null;markdownContentRef;previewImageRef;_sanitizer=u(N);iconsService=u(ee);_contentRendered=!1;_imageHandlers=new Map;_activePointers=new Map;_initialPinchDistance=0;_initialScale=1;_lastPointerPosition=null;_lockedScrollPosition=0;_minScale=1;_maxScale=5;markdownContent="";isPreviewOpen=!1;previewImageSrc="";previewImageAlt="";previewScale=1;previewTranslateX=0;previewTranslateY=0;isPreviewDragging=!1;ngOnChanges(t){t.lesson&&this.lesson&&(this.markdownContent=this.extractMarkdownContent(this.lesson.content),this.resetContentRendered())}ngOnDestroy(){this.removeImageClickHandlers(),this.unlockBodyScroll()}extractMarkdownContent(t){if(t.startsWith("---")){let e=t.indexOf("---",3);if(e!==-1){let n=t.substring(e+3).trim();return this.processCodeBlocks(n)}}return this.processCodeBlocks(t)}processCodeBlocks(t){let e=/```(\w+)?\s*([\s\S]*?)```/g,n=t.replace(e,(i,o,v)=>o?"```"+this.normalizeLanguage(o.toLowerCase())+`
`+v+"```":"```text\n"+v+"```");return n=this.fixImagePaths(n),n}fixImagePaths(t){let e=/(!\[.*?\]\(|\<img[^>]+src=["'])(\/?content\/)([^"')]+)(["'][^>]*\>|\))/g;return t.replace(e,(i,o,v,g,ne)=>o+"assets/content/"+g+ne)}normalizeLanguage(t){return{"c++":"cpp",c:"c",arduino:"arduino",js:"javascript",javascript:"javascript",ts:"typescript",typescript:"typescript",html:"markup",xml:"markup",css:"css",scss:"scss",bash:"bash",shell:"bash",sh:"bash",json:"json",md:"markdown",markdown:"markdown"}[t]||t}ngAfterViewChecked(){this.lesson&&!this._contentRendered&&this.markdownContentRef&&(this._contentRendered=!0,setTimeout(()=>{this.markdownContentRef&&typeof window<"u"&&window.Prism&&window.Prism.highlightAll(),this.enhanceImagesForPreview()},500))}resetContentRendered(){this._contentRendered=!1,this.removeImageClickHandlers()}enhanceImagesForPreview(){if(!this.markdownContentRef)return;let t=this.markdownContentRef.nativeElement,e=Array.from(t.querySelectorAll("img"));this.removeImageClickHandlers(),e.forEach(n=>{n.style.cursor="zoom-in",n.setAttribute("role","button"),n.setAttribute("tabindex","0");let i=v=>{v.preventDefault(),v.stopPropagation();let g=v.currentTarget;this.openPreview(g.currentSrc||g.src,g.alt||"")},o=v=>{let g=v;(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),this.openPreview(n.currentSrc||n.src,n.alt||""))};n.addEventListener("click",i),n.addEventListener("keydown",o),this._imageHandlers.set(n,{click:i,keydown:o})})}removeImageClickHandlers(){this._imageHandlers.forEach((t,e)=>{e.removeEventListener("click",t.click),e.removeEventListener("keydown",t.keydown),e.style.cursor="",e.removeAttribute("role"),e.removeAttribute("tabindex")}),this._imageHandlers.clear()}openPreview(t,e){this.previewImageSrc=t,this.previewImageAlt=e,this.resetPreviewTransform(),this.isPreviewOpen=!0,this.lockBodyScroll()}closePreview(){this.isPreviewOpen&&(this.isPreviewOpen=!1,this.resetPreviewTransform(),this.unlockBodyScroll(),this._activePointers.clear(),this.isPreviewDragging=!1)}resetPreviewTransform(){this.previewScale=1,this.previewTranslateX=0,this.previewTranslateY=0,this.isPreviewDragging=!1,this._initialScale=1,this._initialPinchDistance=0,this._lastPointerPosition=null}onPreviewPointerDown(t){if(!this.isPreviewOpen)return;let e=t.target;if(e?.closest(".image-preview-controls")||e?.closest(".image-preview-close"))return;if(t.currentTarget.setPointerCapture(t.pointerId),this._activePointers.set(t.pointerId,t),this._activePointers.size===1)this._lastPointerPosition={x:t.clientX,y:t.clientY},this.isPreviewDragging=this.previewScale>1;else if(this._activePointers.size===2){let[i,o]=Array.from(this._activePointers.values());this._initialPinchDistance=this.getPointersDistance(i,o),this._initialScale=this.previewScale,this.isPreviewDragging=!1}t.preventDefault(),t.stopPropagation()}onPreviewPointerMove(t){if(!this.isPreviewOpen||!this._activePointers.has(t.pointerId))return;let e=t.target;if(!(e?.closest(".image-preview-controls")||e?.closest(".image-preview-close"))){if(this._activePointers.set(t.pointerId,t),this._activePointers.size===1&&this.previewScale>1){if(this._lastPointerPosition){let n=t.clientX-this._lastPointerPosition.x,i=t.clientY-this._lastPointerPosition.y;this.previewTranslateX+=n,this.previewTranslateY+=i,this._lastPointerPosition={x:t.clientX,y:t.clientY}}}else if(this._activePointers.size===2){let[n,i]=Array.from(this._activePointers.values()),o=this.getPointersDistance(n,i);if(this._initialPinchDistance>0){let v=o/this._initialPinchDistance*this._initialScale,g=Math.max(this._minScale,Math.min(this._maxScale,v));this.previewScale=g,this.previewTranslateX=0,this.previewTranslateY=0}}t.preventDefault(),t.stopPropagation()}}onPreviewPointerUp(t){if(!this._activePointers.has(t.pointerId))return;let e=t.target;if(e?.closest(".image-preview-controls")||e?.closest(".image-preview-close"))return;let n=t.currentTarget;if(n.hasPointerCapture(t.pointerId)&&n.releasePointerCapture(t.pointerId),this._activePointers.delete(t.pointerId),this._activePointers.size===1){let[i]=Array.from(this._activePointers.values());this._lastPointerPosition={x:i.clientX,y:i.clientY},this.isPreviewDragging=this.previewScale>1}else this._lastPointerPosition=null,this.isPreviewDragging=!1;this._activePointers.size<2&&(this._initialPinchDistance=0,this._initialScale=this.previewScale),t.preventDefault(),t.stopPropagation()}onPreviewWheel(t){if(!this.isPreviewOpen)return;t.preventDefault(),t.stopPropagation();let e=t.deltaY<0?1.1:.9,n=this.previewScale*e;n=Math.max(this._minScale,Math.min(this._maxScale,n)),n!==this.previewScale&&(this.previewScale=n,this.previewTranslateX=0,this.previewTranslateY=0,this.isPreviewDragging=!1)}getPointersDistance(t,e){let n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.hypot(n,i)}get previewTransformStyle(){return`translate(${this.previewTranslateX}px, ${this.previewTranslateY}px) scale(${this.previewScale})`}changeZoom(t){let e=Math.max(this._minScale,Math.min(this._maxScale,this.previewScale+t));e!==this.previewScale&&(this.previewScale=e,this.previewTranslateX=0,this.previewTranslateY=0,this.isPreviewDragging=!1,this._initialScale=e,this._initialPinchDistance=0,this._lastPointerPosition=null)}lockBodyScroll(){typeof document>"u"||typeof window>"u"||(this._lockedScrollPosition=window.scrollY,document.body.style.top=`-${this._lockedScrollPosition}px`,document.body.style.position="fixed",document.body.style.width="100%",document.body.style.overflow="hidden",document.body.style.overscrollBehavior="contain")}unlockBodyScroll(){typeof document>"u"||typeof window>"u"||(document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.overflow="",document.body.style.overscrollBehavior="",window.scrollTo(0,this._lockedScrollPosition))}handleKeydown(t){t.key==="Escape"&&this.isPreviewOpen&&(t.preventDefault(),this.closePreview())}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-lesson-view"]],viewQuery:function(e,n){if(e&1&&(V(le,5),V(ce,5)),e&2){let i;I(i=D())&&(n.markdownContentRef=i.first),I(i=D())&&(n.previewImageRef=i.first)}},hostBindings:function(e,n){e&1&&w("keydown",function(o){return n.handleKeydown(o)},H)},inputs:{lesson:"lesson"},features:[z],decls:2,vars:1,consts:[["markdownContainer",""],["previewImage",""],[1,"lesson-view"],[1,"lesson-loading"],[1,"lesson-header"],[1,"lesson-meta"],[1,"lesson-platform"],[1,"platform-icon"],[1,"platform-name"],[1,"lesson-level"],[1,"level-icon"],[1,"level-name"],[1,"lesson-title"],[1,"lesson-info"],[1,"lesson-tags"],[1,"lesson-version"],[1,"lesson-content"],["lineNumbers","","emoji","",1,"markdown-content",3,"data"],[1,"image-preview-overlay"],[1,"lesson-tag"],[1,"version-label"],[1,"image-preview-overlay",3,"click"],[1,"image-preview-content",3,"click","pointerdown","pointermove","pointerup","pointercancel","pointerleave","wheel"],["draggable","false",3,"src","alt"],[1,"image-preview-controls"],["type","button","aria-label","Zoom in",1,"control-btn",3,"click"],["type","button","aria-label","Zoom out",1,"control-btn",3,"click"],["type","button","aria-label","Reset zoom",1,"control-btn",3,"click"],["type","button","aria-label","Close image preview",1,"image-preview-close",3,"click"]],template:function(e,n){e&1&&h(0,ve,24,13,"div",2)(1,we,4,3,"div",3),e&2&&f(n.lesson?0:1)},dependencies:[L,O,Z,W,T],styles:[".lesson-view[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem 1rem}.lesson-header[_ngcontent-%COMP%]{margin-bottom:2rem}.lesson-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.lesson-platform[_ngcontent-%COMP%], .lesson-level[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:var(--text-sm);color:var(--text-secondary);padding:.25rem .75rem;background:var(--color-surface);border-radius:16px}.platform-icon[_ngcontent-%COMP%], .level-icon[_ngcontent-%COMP%]{font-size:1.2em}.lesson-title[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:var(--text-4xl);font-weight:var(--font-weight-bold);margin-bottom:1rem;color:var(--text-primary);line-height:1.2}.lesson-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.lesson-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.lesson-tag[_ngcontent-%COMP%]{padding:.25rem .75rem;background:var(--color-bg);border-radius:16px;font-size:var(--text-xs);color:var(--text-secondary)}.lesson-version[_ngcontent-%COMP%]{font-size:var(--text-sm);color:var(--text-secondary)}.lesson-content[_ngcontent-%COMP%]{background:var(--color-surface);border-radius:12px;padding:2rem;box-shadow:0 2px 8px #0000001a}  .markdown-content{line-height:1.6;color:var(--text-primary)}  .markdown-content h1,   .markdown-content h2,   .markdown-content h3,   .markdown-content h4,   .markdown-content h5,   .markdown-content h6{margin-top:1.5em;margin-bottom:.75em;font-family:var(--font-display);font-weight:var(--font-weight-bold);color:var(--text-primary)}  .markdown-content h1{font-size:var(--text-3xl)}  .markdown-content h2{font-size:var(--text-2xl)}  .markdown-content h3{font-size:var(--text-xl)}  .markdown-content p{margin-bottom:1.5em}  .markdown-content ul,   .markdown-content ol{margin-bottom:1.5em;padding-left:1.5em}  .markdown-content li{margin-bottom:.5em}  .markdown-content code:not([class*=language-]){font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;background:var(--color-bg);padding:.2em .4em;border-radius:3px;font-size:.9em}  .markdown-content pre{padding:0;margin-bottom:1.5em;border-radius:8px;overflow:auto;scrollbar-width:auto;scrollbar-color:rgba(0,0,0,.2) transparent}  .markdown-content pre::-webkit-scrollbar{width:8px;height:8px}  .markdown-content pre::-webkit-scrollbar-track{background:transparent}  .markdown-content pre::-webkit-scrollbar-thumb{background:#0003;border-radius:4px;opacity:0;transition:opacity .3s ease}  .markdown-content pre::-webkit-scrollbar-thumb:hover{background:#0006}  .markdown-content pre:hover::-webkit-scrollbar-thumb{opacity:1}  .markdown-content pre code{background:transparent;padding:0}  .markdown-content pre[class*=language-]{position:relative;margin:1em 0;border-radius:8px;box-shadow:0 2px 8px #0000001a}  .markdown-content .line-numbers .line-numbers-rows{padding:1em 0}  .markdown-content div.code-toolbar>.toolbar{top:.3em;right:.3em;transition:opacity .3s ease}  .markdown-content div.code-toolbar>.toolbar button{cursor:pointer}  .markdown-content img{max-width:100%;height:auto;border-radius:8px;margin:1.5em 0}  .markdown-content blockquote{border-left:4px solid var(--color-primary);padding-left:1em;margin-left:0;margin-right:0;font-style:italic;color:var(--text-secondary)}  .markdown-content table{width:100%;border-collapse:collapse;margin-bottom:1.5em}  .markdown-content table th,   .markdown-content table td{border:1px solid var(--color-border);padding:.5em;text-align:left}  .markdown-content table th{background:var(--color-bg);font-weight:var(--font-weight-medium)}  .markdown-content pre[class*=language-]{text-shadow:none}.lesson-loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:300px}.lesson-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:var(--text-lg);color:var(--text-secondary)}.image-preview-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000d9;display:flex;align-items:center;justify-content:center;padding:1rem;z-index:2000;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.image-preview-content[_ngcontent-%COMP%]{position:relative;max-width:100%;max-height:100%;touch-action:none;display:flex;flex-direction:column;align-items:center;gap:1rem}.image-preview-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:min(90vw,1200px);max-height:80vh;border-radius:12px;box-shadow:0 12px 40px #00000073;cursor:grab;-webkit-user-select:none;user-select:none;transition:transform .05s ease-out}.image-preview-content.dragging[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:grabbing}.image-preview-controls[_ngcontent-%COMP%]{position:absolute;top:1rem;left:50%;transform:translate(-50%);display:flex;align-items:center;gap:.75rem;background:#000000a6;padding:.6rem 1rem;border-radius:999px;box-shadow:0 8px 24px #00000059;z-index:2100}.control-btn[_ngcontent-%COMP%]{min-width:2.75rem;height:2.75rem;border:none;border-radius:999px;background:#ffffffe6;color:#111;font-size:1.1rem;font-weight:600;cursor:pointer;transition:background .2s ease,transform .2s ease,color .2s ease}.control-btn[_ngcontent-%COMP%]:hover{background:#fff;color:#000;transform:translateY(-1px)}.control-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.image-preview-close[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;border:none;border-radius:999px;background:#000000bf;color:#fff;padding:.6rem 1rem;font-size:.9rem;font-weight:600;cursor:pointer;transition:background .2s ease,transform .2s ease;z-index:2100}.image-preview-close[_ngcontent-%COMP%]:hover{background:#000000d9;transform:translateY(-1px)}.image-preview-close[_ngcontent-%COMP%]:active{transform:scale(.95)}@media (max-width: 768px){.image-preview-content[_ngcontent-%COMP%]{gap:.75rem}.image-preview-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:75vh}.image-preview-close[_ngcontent-%COMP%]{top:.75rem;right:.75rem}.image-preview-controls[_ngcontent-%COMP%]{top:.75rem;padding:.5rem .75rem;gap:.5rem}.control-btn[_ngcontent-%COMP%]{min-width:2.5rem;height:2.5rem}}@media (max-width: 768px){.lesson-title[_ngcontent-%COMP%]{font-size:var(--text-3xl)}.lesson-content[_ngcontent-%COMP%]{padding:1.5rem}}"]})};M();function _e(r,t){if(r&1){let e=S();a(0,"div",4)(1,"p",5),d(2),l(),a(3,"button",2),w("click",function(){m(e);let i=c();return p(i.goBack())}),d(4),x(5,"translate"),l()()}if(r&2){let e=c();s(2),_(e.lessonsService.error()),s(2),k(" \u2190 ",b(5,2,"lessons.backToList")," ")}}var te=class r{lessonsService=u(J);_route=u(Q);_routerService=u(q);_translate=u($);_seoService=u(K);_paramMapSubscription;constructor(){F(()=>{let t=this.lessonsService.currentLesson();t&&this._updateSEOTags(t)})}ngOnInit(){this.lessonsService.lessonsIndex()?this._loadLesson():this.lessonsService.loadLessonsIndex().subscribe(()=>{this._loadLesson()})}goBack(){this._routerService.navigateTo("/learn")}ngOnDestroy(){this._paramMapSubscription&&this._paramMapSubscription.unsubscribe()}_loadLesson(){this._paramMapSubscription=this._route.paramMap.subscribe(t=>{let e=t.get("slug"),n=t.get("platform"),i=t.get("level");if(!e||!n||!i){this._routerService.navigateTo("/learn");return}let o=this._translate.currentLang||this._translate.defaultLang||"";this.lessonsService.loadLesson(e,o,n).subscribe()})}_updateSEOTags(t){let n=(t.platforms||[])[0]||"arduino";this._seoService.updateLessonSeo(t,n,t.level,t.slug)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-lesson-detail-page"]],decls:7,vars:5,consts:[[1,"lesson-detail-page"],[1,"lesson-detail-page__nav"],[1,"back-button",3,"click"],[3,"lesson"],[1,"lesson-detail-page__error"],[1,"error-message"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),w("click",function(){return n.goBack()}),d(3),x(4,"translate"),l()(),P(5,"app-lesson-view",3),h(6,_e,6,4,"div",4),l()),e&2&&(s(3),k(" \u2190 ",b(4,3,"lessons.backToList")," "),s(2),C("lesson",n.lessonsService.currentLesson()),s(),f(n.lessonsService.error()?6:-1))},dependencies:[L,O,E,G,T],styles:[".lesson-detail-page[_ngcontent-%COMP%]{padding:2rem 1rem}.lesson-detail-page__nav[_ngcontent-%COMP%]{max-width:900px;margin:0 auto 1rem}.back-button[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-primary);font-size:var(--text-base);cursor:pointer;padding:.5rem 0}.back-button[_ngcontent-%COMP%]:hover{text-decoration:underline}.lesson-detail-page__error[_ngcontent-%COMP%]{max-width:900px;margin:2rem auto;padding:2rem;background:var(--color-surface);border-radius:12px;text-align:center;box-shadow:0 2px 8px #0000001a}.lesson-detail-page__error[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{font-size:var(--text-lg);color:var(--color-error);margin-bottom:1.5rem}"]})};export{te as LessonDetailPageComponent};
