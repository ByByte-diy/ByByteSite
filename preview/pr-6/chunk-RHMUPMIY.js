import{a as q,c as U}from"./chunk-EMBMJAZL.js";import{a as G,b as H}from"./chunk-DDLHQOII.js";import{a as J}from"./chunk-2DRVM3O4.js";import{a as $}from"./chunk-7TWDENZS.js";import{$ as b,Ba as A,Da as _,E as T,Ga as C,Ia as N,L as i,P as w,Ra as F,S as f,T as u,Ua as Y,V as R,W as z,X as E,Xa as Q,Y as h,Z as a,_ as r,bb as Z,db as W,eb as k,fa as V,fb as y,ha as P,ja as m,ma as D,na as B,oa as j,ra as s,sa as l,t as d,ta as x,wa as p,x as O,xa as g,y as I}from"./chunk-6ZYCMACE.js";import"./chunk-ASRB7XND.js";_();N();Z();_();Y();N();_();var oe=["markdownContainer"];function ie(n,t){if(n&1&&(a(0,"span",17),s(1),r()),n&2){let e=t.$implicit;i(),l(e)}}function re(n,t){if(n&1&&(a(0,"div",13),z(1,ie,2,1,"span",17,R),r()),n&2){let e=m(2);i(),E(e.lesson.tags)}}function ae(n,t){if(n&1&&(a(0,"div",14)(1,"span",18),s(2),r()()),n&2){let e=m(2);i(2),x("v",e.lesson.version)}}function se(n,t){if(n&1&&(a(0,"div",1)(1,"div",3)(2,"div",4)(3,"div",5)(4,"span",6),s(5),r(),a(6,"span",7),s(7),p(8,"translate"),r()(),a(9,"div",8)(10,"span",9),s(11),r(),a(12,"span",10),s(13),p(14,"translate"),r()()(),a(15,"h1",11),s(16),r(),a(17,"div",12),f(18,re,3,0,"div",13),f(19,ae,3,1,"div",14),r()(),a(20,"div",15,0),b(22,"markdown",16),r()()),n&2){let e=m();i(5),l(e.iconsService.getPlatformIcon(e.lesson.platforms[0])),i(2),l(g(8,8,"lessons.platform."+e.lesson.platforms[0])),i(4),l(e.iconsService.getLevelIcon(e.lesson.level)),i(2),l(g(14,10,"lessons.level."+e.lesson.level)),i(3),l(e.lesson.title),i(2),u(e.lesson.tags&&e.lesson.tags.length?18:-1),i(),u(e.lesson.version?19:-1),i(3),h("data",e.markdownContent)}}function le(n,t){n&1&&(a(0,"div",2)(1,"p"),s(2),p(3,"translate"),r()()),n&2&&(i(2),l(g(3,1,"lessons.loading")))}var S=class n{lesson=null;markdownContentRef;_sanitizer=d(F);iconsService=d(H);_contentRendered=!1;markdownContent="";ngOnChanges(t){t.lesson&&this.lesson&&(this.markdownContent=this.extractMarkdownContent(this.lesson.content),this.resetContentRendered())}extractMarkdownContent(t){if(t.startsWith("---")){let e=t.indexOf("---",3);if(e!==-1){let o=t.substring(e+3).trim();return this.processCodeBlocks(o)}}return this.processCodeBlocks(t)}processCodeBlocks(t){let e=/```(\w+)?\s*([\s\S]*?)```/g,o=t.replace(e,(c,v,M)=>v?"```"+this.normalizeLanguage(v.toLowerCase())+`
`+M+"```":"```text\n"+M+"```");return o=this.fixImagePaths(o),o}fixImagePaths(t){let e=/(!\[.*?\]\(|\<img[^>]+src=["'])(\/?content\/)([^"')]+)(["'][^>]*\>|\))/g;return t.replace(e,(c,v,M,L,X)=>v+"assets/content/"+L+X)}normalizeLanguage(t){return{"c++":"cpp",c:"c",arduino:"arduino",js:"javascript",javascript:"javascript",ts:"typescript",typescript:"typescript",html:"markup",xml:"markup",css:"css",scss:"scss",bash:"bash",shell:"bash",sh:"bash",json:"json",md:"markdown",markdown:"markdown"}[t]||t}ngAfterViewChecked(){this.lesson&&!this._contentRendered&&this.markdownContentRef&&(this._contentRendered=!0,setTimeout(()=>{this.markdownContentRef&&typeof window<"u"&&window.Prism&&window.Prism.highlightAll()},500))}resetContentRendered(){this._contentRendered=!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-lesson-view"]],viewQuery:function(e,o){if(e&1&&D(oe,5),e&2){let c;B(c=j())&&(o.markdownContentRef=c.first)}},inputs:{lesson:"lesson"},features:[T],decls:2,vars:1,consts:[["markdownContainer",""],[1,"lesson-view"],[1,"lesson-loading"],[1,"lesson-header"],[1,"lesson-meta"],[1,"lesson-platform"],[1,"platform-icon"],[1,"platform-name"],[1,"lesson-level"],[1,"level-icon"],[1,"level-name"],[1,"lesson-title"],[1,"lesson-info"],[1,"lesson-tags"],[1,"lesson-version"],[1,"lesson-content"],["lineNumbers","","emoji","",1,"markdown-content",3,"data"],[1,"lesson-tag"],[1,"version-label"]],template:function(e,o){e&1&&f(0,se,23,12,"div",1)(1,le,4,3,"div",2),e&2&&u(o.lesson?0:1)},dependencies:[C,y,U,q,k],styles:[".lesson-view[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:2rem 1rem}.lesson-header[_ngcontent-%COMP%]{margin-bottom:2rem}.lesson-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.lesson-platform[_ngcontent-%COMP%], .lesson-level[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:var(--text-sm);color:var(--text-secondary);padding:.25rem .75rem;background:var(--color-surface);border-radius:16px}.platform-icon[_ngcontent-%COMP%], .level-icon[_ngcontent-%COMP%]{font-size:1.2em}.lesson-title[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:var(--text-4xl);font-weight:var(--font-weight-bold);margin-bottom:1rem;color:var(--text-primary);line-height:1.2}.lesson-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.lesson-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.lesson-tag[_ngcontent-%COMP%]{padding:.25rem .75rem;background:var(--color-bg);border-radius:16px;font-size:var(--text-xs);color:var(--text-secondary)}.lesson-version[_ngcontent-%COMP%]{font-size:var(--text-sm);color:var(--text-secondary)}.lesson-content[_ngcontent-%COMP%]{background:var(--color-surface);border-radius:12px;padding:2rem;box-shadow:0 2px 8px #0000001a}  .markdown-content{line-height:1.6;color:var(--text-primary)}  .markdown-content h1,   .markdown-content h2,   .markdown-content h3,   .markdown-content h4,   .markdown-content h5,   .markdown-content h6{margin-top:1.5em;margin-bottom:.75em;font-family:var(--font-display);font-weight:var(--font-weight-bold);color:var(--text-primary)}  .markdown-content h1{font-size:var(--text-3xl)}  .markdown-content h2{font-size:var(--text-2xl)}  .markdown-content h3{font-size:var(--text-xl)}  .markdown-content p{margin-bottom:1.5em}  .markdown-content ul,   .markdown-content ol{margin-bottom:1.5em;padding-left:1.5em}  .markdown-content li{margin-bottom:.5em}  .markdown-content code:not([class*=language-]){font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;background:var(--color-bg);padding:.2em .4em;border-radius:3px;font-size:.9em}  .markdown-content pre{padding:0;margin-bottom:1.5em;border-radius:8px;overflow:auto;scrollbar-width:auto;scrollbar-color:rgba(0,0,0,.2) transparent}  .markdown-content pre::-webkit-scrollbar{width:8px;height:8px}  .markdown-content pre::-webkit-scrollbar-track{background:transparent}  .markdown-content pre::-webkit-scrollbar-thumb{background:#0003;border-radius:4px;opacity:0;transition:opacity .3s ease}  .markdown-content pre::-webkit-scrollbar-thumb:hover{background:#0006}  .markdown-content pre:hover::-webkit-scrollbar-thumb{opacity:1}  .markdown-content pre code{background:transparent;padding:0}  .markdown-content pre[class*=language-]{position:relative;margin:1em 0;border-radius:8px;box-shadow:0 2px 8px #0000001a}  .markdown-content .line-numbers .line-numbers-rows{padding:1em 0}  .markdown-content div.code-toolbar>.toolbar{top:.3em;right:.3em;transition:opacity .3s ease}  .markdown-content div.code-toolbar>.toolbar button{cursor:pointer}  .markdown-content img{max-width:100%;height:auto;border-radius:8px;margin:1.5em 0}  .markdown-content blockquote{border-left:4px solid var(--color-primary);padding-left:1em;margin-left:0;margin-right:0;font-style:italic;color:var(--text-secondary)}  .markdown-content table{width:100%;border-collapse:collapse;margin-bottom:1.5em}  .markdown-content table th,   .markdown-content table td{border:1px solid var(--color-border);padding:.5em;text-align:left}  .markdown-content table th{background:var(--color-bg);font-weight:var(--font-weight-medium)}  .markdown-content pre[class*=language-]{text-shadow:none}.lesson-loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:300px}.lesson-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:var(--text-lg);color:var(--text-secondary)}@media (max-width: 768px){.lesson-title[_ngcontent-%COMP%]{font-size:var(--text-3xl)}.lesson-content[_ngcontent-%COMP%]{padding:1.5rem}}"]})};_();function ce(n,t){if(n&1){let e=V();a(0,"div",4)(1,"p",5),s(2),r(),a(3,"button",2),P("click",function(){O(e);let c=m();return I(c.goBack())}),s(4),p(5,"translate"),r()()}if(n&2){let e=m();i(2),l(e.lessonsService.error()),i(2),x(" \u2190 ",g(5,2,"lessons.backToList")," ")}}var K=class n{lessonsService=d(G);_route=d(Q);_routerService=d(J);_translate=d(W);_seoService=d($);_paramMapSubscription;constructor(){A(()=>{let t=this.lessonsService.currentLesson();t&&this._updateSEOTags(t)})}ngOnInit(){this.lessonsService.lessonsIndex()?this._loadLesson():this.lessonsService.loadLessonsIndex().subscribe(()=>{this._loadLesson()})}goBack(){this._routerService.navigateTo("/learn")}ngOnDestroy(){this._paramMapSubscription&&this._paramMapSubscription.unsubscribe()}_loadLesson(){this._paramMapSubscription=this._route.paramMap.subscribe(t=>{let e=t.get("slug"),o=t.get("platform"),c=t.get("level");if(!e||!o||!c){this._routerService.navigateTo("/learn");return}let v=this._translate.currentLang||this._translate.defaultLang||"";this.lessonsService.loadLesson(e,v,o).subscribe()})}_updateSEOTags(t){let o=(t.platforms||[])[0]||"arduino";this._seoService.updateLessonSeo(t,o,t.level,t.slug)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-lesson-detail-page"]],decls:7,vars:5,consts:[[1,"lesson-detail-page"],[1,"lesson-detail-page__nav"],[1,"back-button",3,"click"],[3,"lesson"],[1,"lesson-detail-page__error"],[1,"error-message"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),P("click",function(){return o.goBack()}),s(3),p(4,"translate"),r()(),b(5,"app-lesson-view",3),f(6,ce,6,4,"div",4),r()),e&2&&(i(3),x(" \u2190 ",g(4,3,"lessons.backToList")," "),i(2),h("lesson",o.lessonsService.currentLesson()),i(),u(o.lessonsService.error()?6:-1))},dependencies:[C,y,S,k],styles:[".lesson-detail-page[_ngcontent-%COMP%]{padding:2rem 1rem}.lesson-detail-page__nav[_ngcontent-%COMP%]{max-width:900px;margin:0 auto 1rem}.back-button[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-primary);font-size:var(--text-base);cursor:pointer;padding:.5rem 0}.back-button[_ngcontent-%COMP%]:hover{text-decoration:underline}.lesson-detail-page__error[_ngcontent-%COMP%]{max-width:900px;margin:2rem auto;padding:2rem;background:var(--color-surface);border-radius:12px;text-align:center;box-shadow:0 2px 8px #0000001a}.lesson-detail-page__error[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{font-size:var(--text-lg);color:var(--color-error);margin-bottom:1.5rem}"]})};export{K as LessonDetailPageComponent};
