@if (lesson) {
  <div class="lesson-view">
    <div class="lesson-header">
      <div class="lesson-meta">
        <div class="lesson-platform">
          <span class="platform-icon">{{ iconsService.getPlatformIcon(lesson.platforms[0]) }}</span>
          <span class="platform-name">{{ 'lessons.platform.' + lesson.platforms[0] | translate }}</span>
        </div>
        <div class="lesson-level">
          <span class="level-icon">{{ iconsService.getLevelIcon(lesson.level) }}</span>
          <span class="level-name">{{ 'lessons.level.' + lesson.level | translate }}</span>
        </div>
      </div>
      
      <h1 class="lesson-title">{{ lesson.title }}</h1>
      
      <div class="lesson-info">
        @if (lesson.tags && lesson.tags.length) {
          <div class="lesson-tags">
            @for (tag of lesson.tags; track tag) {
              <span class="lesson-tag">{{ tag }}</span>
            }
          </div>
        }
        
        @if (lesson.version) {
          <div class="lesson-version">
            <span class="version-label">v{{ lesson.version }}</span>
          </div>
        }
      </div>
    </div>
    
    <div #markdownContainer class="lesson-content">
      <markdown [data]="markdownContent" class="markdown-content" lineNumbers emoji></markdown>
    </div>

    @if (isPreviewOpen) {
      <div class="image-preview-overlay" (click)="closePreview()">
        <div
          class="image-preview-content"
          (click)="$event.stopPropagation()"
          (pointerdown)="onPreviewPointerDown($event)"
          (pointermove)="onPreviewPointerMove($event)"
          (pointerup)="onPreviewPointerUp($event)"
          (pointercancel)="onPreviewPointerUp($event)"
          (pointerleave)="onPreviewPointerUp($event)"
          (wheel)="onPreviewWheel($event)"
          [class.dragging]="isPreviewDragging"
        >
          <img
            #previewImage
            [src]="previewImageSrc"
            [alt]="previewImageAlt"
            [style.transform]="previewTransformStyle"
            draggable="false"
          />

          <div class="image-preview-controls">
            <button type="button" class="control-btn" (click)="changeZoom(0.2)" aria-label="Zoom in">+</button>
            <button type="button" class="control-btn" (click)="changeZoom(-0.2)" aria-label="Zoom out">-</button>
            <button type="button" class="control-btn" (click)="resetPreviewTransform()" aria-label="Reset zoom">
              Reset
            </button>
          </div>

          <button
            type="button"
            class="image-preview-close"
            (click)="closePreview()"
            aria-label="Close image preview"
          >
            Close
          </button>
        </div>
      </div>
    }
  </div>
} @else {
  <div class="lesson-loading">
    <p>{{ 'lessons.loading' | translate }}</p>
  </div>
}
